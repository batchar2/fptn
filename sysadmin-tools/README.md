# Инструменты системного администратора

Эта директория содержит инструменты для развертывания и управления компонентами проекта.

## Автоматическая установка

Для полной автоматической установки и настройки **FPTN-сервера**, **Telegram-бота** и **Grafana** был создан специальный скрипт `install.sh`.

### Как использовать скрипт

1.  **Перейдите в директорию со скриптом:**
    ```bash
    cd sysadmin-tools
    ```

2.  **Сделайте скрипт исполняемым:**
    ```bash
    chmod +x install.sh
    ```

3.  **Запустите скрипт:**
    ```bash
    sudo ./install.sh
    ```
    *Примечание: скрипт требует прав `sudo` для установки FPTN-сервера и его зависимостей.*

### Что делает скрипт

-   **Проверяет наличие зависимостей:** Убеждается, что на вашем сервере установлены `git`, `docker`, `docker-compose`, `curl`, `jq` и `openssl`.
-   **Запрашивает конфигурационные данные:** Скрипт попросит вас ввести:
    -   Согласие на установку FPTN-сервера.
    -   Публичный IP-адрес вашего сервера.
    -   API-токен для Telegram-бота.
    -   Имя исходящего сетевого интерфейса (для FPTN-сервера).
    -   Данные для создания нового пользователя FPTN (имя, пароль, ограничение скорости).

-   **Устанавливает и настраивает FPTN-сервер (опционально):**
    -   **Диагностика GitHub API:** Перед загрузкой скрипт проверяет лимит запросов к GitHub API, чтобы предотвратить ошибки, связанные с его исчерпанием.
    -   Автоматически определяет архитектуру вашего сервера (`amd64` или `arm64`).
    -   Скачивает и устанавливает последнюю версию `.deb` пакета FPTN-сервера с GitHub.
        -   *Примечание: скрипт сначала пытается найти релизы в том репозитории, из которого вы его склонировали. Если релизы не найдены, он автоматически скачивает их из основного репозитория `batchar2/fptn`.*
    -   Генерирует SSL-сертификаты.
    -   Настраивает конфигурационный файл `/etc/fptn/server.conf`.
    -   Создает нового пользователя FPTN.
    -   Устанавливает и настраивает `dnsmasq` для корректной работы DNS.
    -   Запускает и включает автозагрузку сервиса `fptn-server`.

-   **Настраивает Telegram-бота:**
    -   Создает `.env` файл с вашими настройками.
    -   Собирает и запускает Docker-контейнер с ботом.
    -   *Вам все еще может потребоваться вручную отредактировать `servers.json` и `servers_censored_zone.json`, если вы хотите добавить дополнительные серверы.*

-   **Настраивает Grafana:**
    -   Создает `.env` файл с вашими настройками, используя сгенерированный `PROMETHEUS_SECRET_ACCESS_KEY`, который также прописывается в конфигурацию FPTN-сервера.
    -   Запускает Docker-контейнеры с Grafana и Prometheus.

### После установки

-   **FPTN-сервер** будет запущен и готов к работе. В конце работы скрипта вы увидите **токен доступа** для нового пользователя. Сохраните его, он понадобится для подключения к вашему VPN.
-   **Telegram-бот** будет запущен в фоновом режиме.
-   **Grafana** будет доступна по адресу `http://<ваш_ip>:3000`.
    -   Логин и пароль по умолчанию: `admin` / `admin`.
    -   **Обязательно смените пароль после первого входа!**

### Остановка сервисов

-   **FPTN-сервер:**
    ```bash
    sudo systemctl stop fptn-server
    ```
-   **Telegram-бот и Grafana:**
    Чтобы остановить запущенные Docker-сервисы, используйте команду `docker-compose down` в соответствующих директориях:
    -   `sysadmin-tools/telegram-bot`
    -   `sysadmin-tools/grafana`
